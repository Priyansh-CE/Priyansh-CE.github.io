<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Neon Worm Arena Pro</title>
<style>
body{
margin:0;
overflow:hidden;
background:#0a0f1f;
font-family:Arial;
color:white;
}
#ui{
position:fixed;
top:10px;
left:20px;
}
#leaderboard{
position:fixed;
top:10px;
right:20px;
text-align:right;
}
#powerups{
position:fixed;
bottom:20px;
left:50%;
transform:translateX(-50%);
}
button{
margin:5px;
padding:5px 10px;
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="ui">
Score: <span id="score">0</span><br>
Highscore: <span id="highscore">0</span>
</div>

<div id="leaderboard"></div>

<div id="powerups">
Magnet: <span id="magnetUI">OFF</span>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

let mouse={x:0,y:0};
let boosting=false;
let score=0;
let magnet=false;
let magnetTime=0;
let particles=[];
let bgStars=[];
let highscore=localStorage.getItem("wormHighscore")||0;
document.getElementById("highscore").innerText=highscore;

function playSound(freq){
const a=new(window.AudioContext||window.webkitAudioContext)();
const o=a.createOscillator();
const g=a.createGain();
o.connect(g);
g.connect(a.destination);
o.frequency.value=freq;
o.start();
g.gain.setValueAtTime(0.2,a.currentTime);
g.gain.exponentialRampToValueAtTime(0.001,a.currentTime+0.2);
o.stop(a.currentTime+0.2);
}

class Worm{
constructor(x,y,color,isAI=false){
this.x=x;
this.y=y;
this.segments=[];
this.size=14;
this.length=30;
this.speed=120;
this.color=color;
this.angle=0;
this.isAI=isAI;
this.alive=true;

for(let i=0;i<this.length;i++){
this.segments.push({x,y});
}
}

update(dt){
if(!this.alive) return;

if(this.isAI){
let dx=player.x-this.x;
let dy=player.y-this.y;
let target=Math.atan2(dy,dx);
this.angle+=(target-this.angle)*0.02;
}else{
let dx=mouse.x-canvas.width/2;
let dy=mouse.y-canvas.height/2;
let target=Math.atan2(dy,dx);
this.angle+=(target-this.angle)*0.1;
}

let s=this.speed;
if(boosting&&!this.isAI) s*=1.8;

this.x+=Math.cos(this.angle)*s*dt;
this.y+=Math.sin(this.angle)*s*dt;

this.segments.unshift({x:this.x,y:this.y});
while(this.segments.length>this.length){
this.segments.pop();
}
}

draw(){
if(!this.alive) return;

this.segments.forEach((seg,i)=>{
ctx.fillStyle=this.color;
ctx.beginPath();
ctx.arc(seg.x,seg.y,this.size,0,Math.PI*2);
ctx.fill();
});
}
}

class Food{
constructor(){
this.x=(Math.random()-0.5)*3000;
this.y=(Math.random()-0.5)*3000;
this.size=8;
this.color=`hsl(${Math.random()*360},100%,60%)`;
}
draw(){
ctx.fillStyle=this.color;
ctx.beginPath();
ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
ctx.fill();
}
}

class Particle{
constructor(x,y,color){
this.x=x;
this.y=y;
this.dx=(Math.random()-0.5)*6;
this.dy=(Math.random()-0.5)*6;
this.life=60;
this.color=color;
}
update(){
this.x+=this.dx;
this.y+=this.dy;
this.life--;
}
draw(){
ctx.fillStyle=this.color;
ctx.fillRect(this.x,this.y,3,3);
}
}

let player=new Worm(0,0,"#00f0ff");
let worms=[player];
let foods=[];

for(let i=0;i<5;i++){
worms.push(new Worm(
(Math.random()-0.5)*2000,
(Math.random()-0.5)*2000,
`hsl(${Math.random()*360},100%,60%)`,
true
));
}

for(let i=0;i<200;i++) foods.push(new Food());

for(let i=0;i<200;i++){
bgStars.push({
x:Math.random()*canvas.width,
y:Math.random()*canvas.height,
r:Math.random()*2
});
}

function updateCamera(){
camera.x+=(player.x-camera.x)*0.08;
camera.y+=(player.y-camera.y)*0.08;
}

let camera={x:0,y:0};

function checkFood(){
foods.forEach((f,i)=>{
let dx=player.x-f.x;
let dy=player.y-f.y;
let d=Math.sqrt(dx*dx+dy*dy);

if(magnet&&d<200){
f.x+=dx*-0.05;
f.y+=dy*-0.05;
}

if(d<player.size){
player.length+=2;
score+=10;
playSound(400);
foods.splice(i,1);
foods.push(new Food());
document.getElementById("score").innerText=score;

if(score>highscore){
highscore=score;
localStorage.setItem("wormHighscore",highscore);
document.getElementById("highscore").innerText=highscore;
}
}
});
}

function checkCollision(){
worms.forEach(w=>{
if(w===player||!w.alive) return;
w.segments.forEach(seg=>{
let dx=player.x-seg.x;
let dy=player.y-seg.y;
if(Math.sqrt(dx*dx+dy*dy)<player.size){
player.alive=false;
explode(player);
}
});
});
}

function explode(w){
w.segments.forEach(seg=>{
particles.push(new Particle(seg.x,seg.y,w.color));
foods.push(new Food());
});
playSound(100);
setTimeout(()=>location.reload(),2000);
}

function updateLeaderboard(){
worms.sort((a,b)=>b.length-a.length);
let text="<b>Leaderboard</b><br>";
worms.slice(0,5).forEach((w,i)=>{
text+=(i+1)+". "+(w===player?"You":"AI")+" ("+w.length+")<br>";
});
document.getElementById("leaderboard").innerHTML=text;
}

function drawBackground(){
ctx.fillStyle="#0a0f1f";
ctx.fillRect(0,0,canvas.width,canvas.height);
ctx.fillStyle="white";
bgStars.forEach(st=>{
ctx.beginPath();
ctx.arc(st.x,st.y,st.r,0,Math.PI*2);
ctx.fill();
});
}

let last=0;
function loop(t){
let dt=(t-last)/1000;
last=t;

drawBackground();

updateCamera();

ctx.save();
ctx.translate(canvas.width/2-camera.x,canvas.height/2-camera.y);

foods.forEach(f=>f.draw());

worms.forEach(w=>{
w.update(dt);
w.draw();
});

checkFood();
checkCollision();

particles.forEach((p,i)=>{
p.update();
p.draw();
if(p.life<=0) particles.splice(i,1);
});

ctx.restore();

if(magnet){
magnetTime-=dt;
if(magnetTime<=0){
magnet=false;
document.getElementById("magnetUI").innerText="OFF";
}
}

updateLeaderboard();
requestAnimationFrame(loop);
}

canvas.addEventListener("mousemove",e=>{
mouse.x=e.clientX;
mouse.y=e.clientY;
});

canvas.addEventListener("mousedown",()=>boosting=true);
canvas.addEventListener("mouseup",()=>boosting=false);

window.addEventListener("keydown",e=>{
if(e.key==="m"){
magnet=true;
magnetTime=5;
document.getElementById("magnetUI").innerText="ON";
}
});

requestAnimationFrame(loop);
</script>
</body>
</html>
