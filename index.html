<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Snake Arena Evolution</title>
<style>
body{margin:0;overflow:hidden;background:#020617;font-family:Arial}
canvas{display:block}
#ui{
position:fixed;
top:10px;
left:10px;
color:white;
font-size:14px;
}
#leaderboard{
position:fixed;
top:10px;
right:10px;
color:white;
text-align:right;
}
</style>
</head>
<body>

<div id="ui">
<div id="score"></div>
</div>

<div id="leaderboard"></div>

<canvas id="game"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

const MAP_SIZE=4000;
let keys={};

class Food{
constructor(x,y){
this.x=x;
this.y=y;
this.size=4+Math.random()*4;
}
draw(){
ctx.beginPath();
ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
ctx.fillStyle="hsl("+Math.random()*360+",80%,60%)";
ctx.fill();
}
}

class Snake{
constructor(x,y,color,ai=false){
this.x=x;
this.y=y;
this.body=[];
this.mass=40;
this.speed=140;
this.angle=0;
this.color=color;
this.ai=ai;
this.alive=true;
this.name=ai?"AI-"+Math.floor(Math.random()*100):"You";
for(let i=0;i<this.mass;i++){
this.body.push({x,y});
}
}

get radius(){
return 8+this.mass*0.05;
}

update(dt){
if(!this.alive)return;

if(!this.ai){
if(keys["ArrowLeft"]) this.angle-=3*dt;
if(keys["ArrowRight"]) this.angle+=3*dt;
}else{
let target=foods[Math.floor(Math.random()*foods.length)];
if(target){
this.angle=Math.atan2(target.y-this.y,target.x-this.x);
}
}

this.x+=Math.cos(this.angle)*this.speed*dt;
this.y+=Math.sin(this.angle)*this.speed*dt;

this.body.unshift({x:this.x,y:this.y});
while(this.body.length>this.mass){
this.body.pop();
}
}

draw(){
if(!this.alive)return;
ctx.beginPath();
for(let i=0;i<this.body.length;i++){
ctx.lineTo(this.body[i].x,this.body[i].y);
}
ctx.strokeStyle=this.color;
ctx.lineWidth=this.radius;
ctx.lineCap="round";
ctx.stroke();
}
}

let player=new Snake(0,0,"#22c55e");
let snakes=[player];

for(let i=0;i<5;i++){
snakes.push(new Snake(
Math.random()*2000-1000,
Math.random()*2000-1000,
`hsl(${Math.random()*360},70%,60%)`,
true
));
}

let foods=[];
for(let i=0;i<300;i++){
foods.push(new Food(
Math.random()*MAP_SIZE-MAP_SIZE/2,
Math.random()*MAP_SIZE-MAP_SIZE/2
));
}

function checkFood(snake){
foods.forEach((f,i)=>{
let dx=snake.x-f.x;
let dy=snake.y-f.y;
if(Math.sqrt(dx*dx+dy*dy)<snake.radius){
snake.mass+=2;
foods.splice(i,1);
foods.push(new Food(
Math.random()*MAP_SIZE-MAP_SIZE/2,
Math.random()*MAP_SIZE-MAP_SIZE/2
));
}
});
}

function checkCollision(a,b){
if(!a.alive||!b.alive)return;
for(let i=10;i<b.body.length;i++){
let dx=a.x-b.body[i].x;
let dy=a.y-b.body[i].y;
if(Math.sqrt(dx*dx+dy*dy)<b.radius){
a.alive=false;
b.mass+=Math.floor(a.mass/2);
}
}
}

let camera={x:0,y:0};
let last=0;

function loop(t){
let dt=(t-last)/1000;
last=t;

ctx.clearRect(0,0,canvas.width,canvas.height);

camera.x=player.x;
camera.y=player.y;

ctx.save();
ctx.translate(canvas.width/2,canvas.height/2);
ctx.translate(-camera.x,-camera.y);

foods.forEach(f=>f.draw());

snakes.forEach(s=>s.update(dt));
snakes.forEach(s=>checkFood(s));

for(let i=0;i<snakes.length;i++){
for(let j=0;j<snakes.length;j++){
if(i!==j) checkCollision(snakes[i],snakes[j]);
}
}

snakes.forEach(s=>s.draw());

ctx.restore();

updateLeaderboard();

requestAnimationFrame(loop);
}

function updateLeaderboard(){
let alive=snakes.filter(s=>s.alive);
alive.sort((a,b)=>b.mass-a.mass);
document.getElementById("leaderboard").innerHTML=
"<b>Leaderboard</b><br>"+
alive.slice(0,5).map(s=>s.name+" : "+Math.floor(s.mass)).join("<br>");

document.getElementById("score").innerText=
"Mass: "+Math.floor(player.mass);
}

window.addEventListener("keydown",e=>keys[e.key]=true);
window.addEventListener("keyup",e=>keys[e.key]=false);

requestAnimationFrame(loop);
</script>

</body>
</html>
