<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ULTRA GOD MODE OFFLINE ARENA</title>
<style>
body{margin:0;overflow:hidden;background:#060612;font-family:Arial;color:white}
canvas{display:block}
#hud{position:fixed;top:10px;left:10px;z-index:10;}
#menu{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
background:#111;padding:30px;border-radius:15px;text-align:center;display:none;z-index:50;}
button{padding:10px 20px;margin-top:15px;border:none;border-radius:8px;background:#00ffaa;font-weight:bold;cursor:pointer;}
</style>
</head>
<body>

<div id="hud"></div>

<div id="menu">
<h2>GAME OVER</h2>
<button onclick="restart()">Restart</button>
</div>

<canvas id="game"></canvas>

<script>
// ===== SETTINGS =====
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth; canvas.height=innerHeight;
window.addEventListener("resize",()=>{canvas.width=innerWidth; canvas.height=innerHeight;});

const worldSize=7000;
let foods=[], particles=[], bg=[];
let gameOver=false;
let highScore=localStorage.getItem("ultraArenaHigh")||0;

// ===== UTILS =====
function distance(a,b){return Math.hypot(a.x-b.x,a.y-b.y);}
function restart(){location.reload();}

// ===== SNAKE CLASS =====
class Snake{
constructor(x,y,color,isAI=false,isBoss=false,controls=null){
this.points=[{x,y}];
this.length=isBoss?600:250;
this.color=color;
this.angle=0;
this.targetAngle=0;
this.turnSpeed=0.08;
this.baseSpeed=2;
this.speed=2;
this.boost=false;
this.stamina=100;
this.isAI=isAI;
this.isBoss=isBoss;
this.alive=true;
this.magnet=0;
this.score=0;
this.controls=controls;
}
update(){
if(!this.alive)return;

// AI
if(this.isAI){
let target={x:player1.points[0].x,y:player1.points[0].y};
let dx=target.x-this.points[0].x, dy=target.y-this.points[0].y;
let dist=Math.hypot(dx,dy);
if(dist<600)this.targetAngle=Math.atan2(dy,dx);
else this.targetAngle+=(Math.random()-0.5)*0.3;
}

// smooth turning
let diff=this.targetAngle-this.angle;
diff=Math.atan2(Math.sin(diff),Math.cos(diff));
this.angle+=diff*this.turnSpeed;

// speed
this.speed=this.baseSpeed;
if(this.boost && this.stamina>0){this.speed=4; this.stamina-=0.7;}
else this.stamina+=0.4;
if(this.stamina>100)this.stamina=100;

// move
this.points.unshift({x:this.points[0].x+Math.cos(this.angle)*this.speed, y:this.points[0].y+Math.sin(this.angle)*this.speed});
for(let i=1;i<this.points.length;i++){
let dx=this.points[i-1].x-this.points[i].x;
let dy=this.points[i-1].y-this.points[i].y;
this.points[i].x+=dx*0.3; this.points[i].y+=dy*0.3;}
if(this.points.length>this.length/4)this.points.pop();
}
draw(){
if(!this.alive)return;
ctx.beginPath(); ctx.lineJoin="round"; ctx.lineCap="round";
ctx.lineWidth=this.isBoss?22:16;
ctx.strokeStyle=this.color;
ctx.shadowBlur=20; ctx.shadowColor=this.color;
ctx.moveTo(this.points[0].x,this.points[0].y);
for(let p of this.points) ctx.lineTo(p.x,p.y);
ctx.stroke(); ctx.shadowBlur=0;
}
explode(){
for(let i=0;i<100;i++){
particles.push({x:this.points[0].x,y:this.points[0].y,vx:(Math.random()-0.5)*8,vy:(Math.random()-0.5)*8,life:60,size:Math.random()*5+2,color:this.color});
foods.push({x:this.points[0].x+(Math.random()-0.5)*200, y:this.points[0].y+(Math.random()-0.5)*200, rare:false});
}
this.alive=false;
}
}

// ===== SPAWN PLAYERS =====
let player1=new Snake(worldSize/2,worldSize/2,"#00ffaa");
let player2=new Snake(worldSize/2+100,worldSize/2+100,"#ff007f",false,false,{up:"w",down:"s",left:"a",right:"d",boost:"Shift"});
let player3=new Snake(worldSize/2-100,worldSize/2-100,"#00aaff",false,false,{up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",boost:" "});
let players=[player1,player2,player3];

// ===== SPAWN AI + BOSS =====
let aiEnemies=[];
function spawnAI(){for(let i=0;i<6;i++){aiEnemies.push(new Snake(Math.random()*worldSize,Math.random()*worldSize,`hsl(${Math.random()*360},80%,60%)`,true));}}
function spawnBoss(){aiEnemies.push(new Snake(Math.random()*worldSize,Math.random()*worldSize,"#ff0000",true,true));}
spawnAI(); spawnBoss();

// ===== FOOD & BG =====
function spawnFood(){for(let i=0;i<500;i++){foods.push({x:Math.random()*worldSize,y:Math.random()*worldSize,rare:Math.random()<0.05});}}
function spawnBG(){for(let i=0;i<200;i++){bg.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*2,speed:Math.random()*0.5+0.2});}}
spawnFood(); spawnBG();

// ===== CONTROLS =====
// Mouse for player1
canvas.addEventListener("mousemove",e=>{
player1.targetAngle=Math.atan2(e.clientY-canvas.height/2,e.clientX-canvas.width/2);
});
window.addEventListener("mousedown",()=>player1.boost=true);
window.addEventListener("mouseup",()=>player1.boost=false);

// Keyboard
const keys={};
window.addEventListener("keydown",e=>{keys[e.key]=true;});
window.addEventListener("keyup",e=>{keys[e.key]=false;});
function controlSnake(s){
if(!s.controls||!s.alive)return;
if(keys[s.controls.left])s.targetAngle=Math.PI;
if(keys[s.controls.right])s.targetAngle=0;
if(keys[s.controls.up])s.targetAngle=-Math.PI/2;
if(keys[s.controls.down])s.targetAngle=Math.PI/2;
s.boost=keys[s.controls.boost];
}

// ===== GAME LOGIC =====
function collisions(){
[...players,...aiEnemies].forEach(s=>{
if(!s.alive)return;
[...players,...aiEnemies].forEach(t=>{
if(s===t||!t.alive)return;
for(let i=5;i<t.points.length;i++){if(distance(s.points[0],t.points[i])<12){s.explode(); if(!s.isAI)s.alive=false;}}
});
});
}
function eatFood(){
[...players,...aiEnemies].forEach(s=>{
foods.forEach((f,i)=>{
let range=s.magnet>0?200:20;
if(distance(s.points[0],f)<range){
if(s.magnet>0){f.x+=(s.points[0].x-f.x)*0.2; f.y+=(s.points[0].y-f.y)*0.2;}
if(distance(s.points[0],f)<15){foods.splice(i,1); s.length+=f.rare?100:30; s.score+=f.rare?50:10;}
}
});
});
}
function updateParticles(){particles.forEach((p,i)=>{p.x+=p.vx;p.y+=p.vy;p.life--; if(p.life<=0)particles.splice(i,1);});}

function update(){
if(gameOver)return;
players.forEach(s=>controlSnake(s));
[...players,...aiEnemies].forEach(s=>s.update());
collisions(); eatFood(); updateParticles();
}

// ===== DRAW LOOP =====
function draw(){
ctx.clearRect(0,0,canvas.width,canvas.height);
let zoom=1+(player1.length/2500);
ctx.save();
ctx.translate(canvas.width/2, canvas.height/2);
ctx.scale(zoom,zoom);
ctx.translate(-player1.points[0].x,-player1.points[0].y);

// bg
bg.forEach(p=>{ctx.fillStyle="rgba(255,255,255,0.1)";ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill(); p.y+=p.speed; if(p.y>canvas.height)p.y=0;});

// food
foods.forEach(f=>{ctx.fillStyle=f.rare?"#ff00ff":"#ffaa00"; ctx.beginPath(); ctx.arc(f.x,f.y,f.rare?6:4,0,Math.PI*2); ctx.fill();});

// particles
particles.forEach(p=>{ctx.fillStyle=p.color; ctx.globalAlpha=p.life/60; ctx.beginPath();ctx.arc(p.x,p.y,p.size,0,Math.PI*2);ctx.fill(); ctx.globalAlpha=1;});

// snakes
[...players,...aiEnemies].forEach(s=>s.draw());
ctx.restore();

// HUD
let hudText=""; players.forEach((s,i)=>{hudText+=`P${i+1} Score: ${s.score} Stamina:${Math.floor(s.stamina)}<br>`;});
document.getElementById("hud").innerHTML=hudText;
}

// ===== GAME LOOP =====
function loop(){update(); draw(); requestAnimationFrame(loop);}
loop();
</script>

</body>
</html>
